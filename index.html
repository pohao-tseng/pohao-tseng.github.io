<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PO-HAO TSENG | 意義場</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <style>
        :root {
            --bg-color: #050505;
            --text-color: #e0e0e0;
            --accent-color: #888;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background-color: var(--bg-color);
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            color: var(--text-color); -webkit-tap-highlight-color: transparent;
        }

        /* --- LAYERS --- */
        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        #ui-layer { position: relative; z-index: 10; width: 100%; height: 100%; pointer-events: none; }
        .interactive { pointer-events: auto; }

        /* --- LANGUAGE TOGGLE CLASSES --- */
        body.lang-en .zh-only { display: none !important; }
        body.lang-zh .en-only { display: none !important; }

        /* --- 0. LANGUAGE SELECT --- */
        #lang-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: #000; z-index: 200; transition: opacity 1s ease;
        }
        .lang-opt {
            font-size: 1rem; letter-spacing: 5px; color: #888; cursor: pointer;
            padding: 20px; border: 1px solid transparent; transition: all 0.3s;
            text-transform: uppercase; margin: 10px 0; width: 200px; text-align: center;
        }
        .lang-opt:hover { color: #fff; border: 1px solid #333; letter-spacing: 8px; background: rgba(255,255,255,0.05); }

        /* --- 1. LANDING --- */
        #landing-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            background: rgba(5,5,5,0.85); transition: opacity 1.5s ease; z-index: 50;
        }
        h1 { 
            font-weight: 300; letter-spacing: 8px; font-size: 1.5rem; margin-bottom: 2rem; 
            text-transform: uppercase; text-shadow: 0 0 15px rgba(255,255,255,0.3); text-align: center;
            cursor: pointer; transition: opacity 0.3s;
        }
        h1:hover { opacity: 0.7; }
        
        #enter-btn {
            background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.4); color: #fff;
            padding: 15px 50px; font-size: 0.9rem; cursor: pointer; transition: all 0.3s ease; letter-spacing: 3px;
        }
        #enter-btn:active, #enter-btn:hover { background: rgba(255,255,255,0.25); box-shadow: 0 0 25px rgba(255,255,255,0.3); }

        /* --- NAV & HEADER --- */
        #site-header { position: absolute; top: 40px; left: 50px; z-index: 40; opacity: 0; transform: translateY(-20px); pointer-events: auto; }
        #site-title { font-size: 1.2rem; letter-spacing: 5px; color: #fff; text-decoration: none; font-weight: 300; cursor: pointer; display: block; margin-bottom: 5px; }
        nav { position: absolute; bottom: 40px; left: 50px; display: flex; gap: 25px; opacity: 0; transform: translateY(20px); z-index: 40; flex-wrap: wrap;}
        .nav-link { text-decoration: none; color: #777; font-size: 0.85rem; letter-spacing: 1.5px; cursor: pointer; transition: color 0.3s; padding: 5px 0; }
        .nav-link:hover, .nav-link.active { color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.6); border-bottom: 1px solid #fff; }

        /* --- CONTENT SECTION --- */
        .content-section {
            position: absolute; top: 0; right: 0; width: 50%; height: 100%;
            background: linear-gradient(to left, rgba(0,0,0,0.98) 20%, rgba(0,0,0,0.85) 100%);
            display: none; opacity: 0; padding: 80px 60px; box-sizing: border-box;
            overflow-y: auto; -webkit-overflow-scrolling: touch;
        }
        .content-section.active { display: block; }
        .content-section::-webkit-scrollbar { width: 6px; }
        .content-section::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }

        /* Typography */
        .text-block { margin-top: 40px; margin-bottom: 120px; }
        .text-block h2 { font-weight: 200; font-size: 2rem; margin-bottom: 40px; border-bottom: 1px solid #555; padding-bottom: 15px; color: #fff; letter-spacing: 2px; }
        .category-title { font-size: 1.1rem; color: #fff; margin-top: 60px; margin-bottom: 30px; padding-left: 10px; border-left: 3px solid #888; letter-spacing: 1px; }
        .text-block p { line-height: 1.8; font-size: 0.95rem; color: #ccc; margin-bottom: 20px; text-align: justify; }
        
        /* Method Specific */
        .method-quote { border-left: 2px solid #fff; padding-left: 20px; margin: 30px 0; font-style: italic; color: #aaa; font-size: 1.1rem;}
        .method-list { margin-left: 20px; margin-bottom: 30px; }
        .method-list li { margin-bottom: 15px; color: #ccc; line-height: 1.6; }
        .method-subtitle { color: #fff; font-size: 1.1rem; margin-top: 30px; margin-bottom: 15px; font-weight: 500;}

        /* TEST UI OVERLAY */
        #test-ui, #result-ui {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            z-index: 60; pointer-events: none; /* Let clicks pass through for interaction */
        }
        #test-ui.active, #result-ui.active { display: flex; }
        
        .test-msg { font-size: 1.2rem; color: #fff; letter-spacing: 2px; text-align: center; margin-bottom: 20px; text-shadow: 0 0 10px #000; }
        .timer { font-size: 4rem; font-weight: 100; color: #fff; font-family: monospace; }
        
        /* RESULT UI */
        #result-ui { background: rgba(0,0,0,0.6); pointer-events: auto; }
        .result-title { font-size: 3rem; color: #fff; letter-spacing: 5px; margin-bottom: 10px; text-transform: uppercase; text-shadow: 0 0 20px rgba(255,255,255,0.5); }
        .result-desc { font-size: 1rem; color: #ccc; max-width: 600px; text-align: center; line-height: 1.6; margin-bottom: 40px; }
        .result-btn-group { display: flex; gap: 20px; }
        .result-btn {
            background: transparent; border: 1px solid #fff; color: #fff; padding: 10px 30px;
            cursor: pointer; transition: all 0.3s; letter-spacing: 2px;
        }
        .result-btn:hover { background: #fff; color: #000; }

        /* Other Styles (Timeline, Expand, Photo, Gallery) */
        .photo-wrapper { width: 100%; max-width: 300px; margin-bottom: 40px; perspective: 1000px; }
        .about-photo { width: 100%; height: auto; display: block; filter: grayscale(100%) contrast(1.2) brightness(0.9); transition: filter 0.5s ease; box-shadow: 0 10px 30px rgba(0,0,0,0.5); transform-style: preserve-3d; }
        .photo-wrapper:hover .about-photo { filter: grayscale(0%) contrast(1) brightness(1); }
        .timeline-item { position: relative; padding-left: 20px; margin-bottom: 25px; border-left: 1px solid #333; }
        .timeline-item::before { content: ''; position: absolute; left: -4px; top: 6px; width: 7px; height: 7px; background: #666; border-radius: 50%; }
        .year { font-size: 0.8rem; color: #888; font-family: monospace; display: block; margin-bottom: 3px; }
        .job-title { font-size: 0.95rem; color: #fff; font-weight: 500; }
        .job-desc { font-size: 0.85rem; color: #aaa; margin-top: 2px; }
        .expand-container { max-height: 0; overflow: hidden; transition: max-height 0.8s ease; position: relative; }
        .expand-container.collapsed { max-height: 280px; } 
        .expand-container.collapsed::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 80px; background: linear-gradient(to bottom, rgba(0,0,0,0), rgba(5,5,5,0.95)); pointer-events: none; }
        .method-expand.collapsed { max-height: 0; } 
        .expand-btn { display: block; width: 100%; padding: 12px; margin-top: 15px; background: rgba(255,255,255,0.05); border: 1px solid #444; color: #888; cursor: pointer; text-align: center; font-size: 0.8rem; transition: all 0.3s; }
        .expand-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .project-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .project-card { cursor: pointer; position: relative; transition: transform 0.3s; }
        .project-card:hover { transform: translateY(-5px); }
        .project-cover { width: 100%; aspect-ratio: 4/3; object-fit: cover; filter: grayscale(100%); transition: filter 0.5s; border-radius: 2px; }
        .project-card:hover .project-cover { filter: grayscale(0%); }
        .project-title { margin-top: 10px; font-size: 0.9rem; color: #fff; letter-spacing: 1px; }
        .project-year { font-size: 0.8rem; color: #666; font-family: monospace; }
        #project-overlay { position: fixed; top: 0; right: 0; width: 60%; height: 100%; background: #0a0a0a; z-index: 100; transform: translateX(100%); transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1); overflow-y: auto; padding: 60px; box-sizing: border-box; border-left: 1px solid #333; }
        #project-overlay.open { transform: translateX(0); }
        #close-project { position: absolute; top: 30px; right: 30px; font-size: 1.5rem; color: #fff; cursor: pointer; border: 1px solid #333; padding: 5px 15px; transition: all 0.3s; }
        #close-project:hover { background: #fff; color: #000; }
        .detail-header { margin-bottom: 40px; margin-top: 20px;}
        .detail-title { font-size: 2rem; color: #fff; margin-bottom: 10px; }
        .detail-meta { font-family: monospace; color: #888; font-size: 0.9rem; margin-bottom: 30px; }
        .detail-desc { line-height: 1.8; color: #ccc; margin-bottom: 40px; white-space: pre-wrap; }
        .detail-media { margin-bottom: 40px; }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; margin-bottom: 30px; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0; }
        .detail-images img { width: 100%; margin-bottom: 20px; display: block; filter: grayscale(20%); transition: filter 0.5s; }
        .detail-images img:hover { filter: grayscale(0%); }
        .social-links { margin-top: 30px; display: flex; gap: 15px; }
        .social-btn { padding: 8px 20px; border: 1px solid #666; color: #ccc; text-decoration: none; font-size: 0.9rem; border-radius: 2px; }
        .social-btn:hover { border-color: #fff; color: #fff; background: rgba(255,255,255,0.1); }

        @media (max-width: 768px) {
            .content-section { width: 100%; padding: 30px; padding-top: 80px; }
            #project-overlay { width: 100%; padding: 30px; padding-top: 80px; }
            nav { bottom: 0; left: 0; width: 100%; background: rgba(10,10,10,0.95); padding: 15px 0; justify-content: center; gap: 15px; border-top: 1px solid #333; }
            #site-header { top: 30px; left: 30px; }
            .project-grid { grid-template-columns: 1fr; }
            .result-title { font-size: 2rem; }
        }
    </style>
</head>
<body>

    <div id="canvas-container"></div>

    <div id="ui-layer">

        <div id="lang-screen" class="interactive">
            <div class="lang-opt" onclick="setLanguage('zh')">中文</div>
            <div class="lang-opt" onclick="setLanguage('en')">ENGLISH</div>
        </div>
        
        <div id="landing-screen" class="interactive">
            <h1 onclick="enterSite()">PO-HAO TSENG</h1>
            <button id="enter-btn" onclick="enterSite()">
                <span class="zh-only">進入意義場</span>
                <span class="en-only">ENTER MEANING FIELD</span>
            </button>
            <p id="audio-status" style="margin-top: 15px; font-size: 0.7rem; color: #555;">Headphones Recommended</p>
        </div>

        <div id="site-header" class="interactive">
            <div id="site-title" onclick="navigateTo('home')">PO-HAO TSENG</div>
        </div>

        <nav id="main-nav" class="interactive">
            <a class="nav-link" onclick="navigateTo('home')">HOME</a>
            <a class="nav-link" onclick="navigateTo('method')">METHOD</a>
            <a class="nav-link" onclick="navigateTo('about')">ABOUT</a>
            <a class="nav-link" onclick="navigateTo('experiences')">EXPERIENCES</a>
            <a class="nav-link" onclick="navigateTo('gallery')">WORKS</a>
        </nav>

        <div id="test-ui">
            <div class="test-msg zh-only">請在 10 秒內，依照直覺移動你的手指或滑鼠。</div>
            <div class="test-msg en-only">Move your cursor or finger intuitively for 10 seconds.</div>
            <div class="timer" id="test-timer">10</div>
        </div>

        <div id="result-ui" class="interactive">
            <div class="result-title" id="res-type">HUNTER</div>
            <div class="result-desc" id="res-desc">...</div>
            <div class="result-btn-group">
                <button class="result-btn" onclick="resetTest(true)">
                    <span class="zh-only">再測一次</span><span class="en-only">RETRY</span>
                </button>
                <button class="result-btn" onclick="finishTest()">
                    <span class="zh-only">完成</span><span class="en-only">FINISH</span>
                </button>
            </div>
        </div>

        <div id="method" class="content-section interactive">
            <div class="text-block">
                <h2 class="decode-text" data-zh="意義場行動表演法" data-en="Meaning Field Method">意義場行動表演法</h2>
                
                <div style="margin-bottom: 40px; text-align: center;">
                    <button class="expand-btn" style="border: 1px solid #fff; color: #fff; padding: 15px;" onclick="startTest()">
                        <span class="zh-only">◆ 測試你是哪一型 (Hunter / Wizard / Child)</span>
                        <span class="en-only">◆ Test Your Type (Hunter / Wizard / Child)</span>
                    </button>
                </div>

                <div class="zh-only">
                    <div class="method-quote">「表演行動並非再現既有內容，而是在多重脈絡交會中即時生成可被感知的關係結構。」</div>
                    <h3>摘要</h3>
                    <p>《意義場行動表演法》是一種以「意義生成」而非文本、角色或心理動機為起點的表演方法論。</p>
                    <div id="method-full-zh" class="expand-container method-expand collapsed">
                        <div class="method-subtitle">一、理論基礎</div>
                        <p>「意義場」指一組由語言、角色位置、社會脈絡、歷史殘留、空間條件與時間尺度所構成的動態關係網絡。</p>
                        <div class="method-subtitle">二、三種初始行動樣態</div>
                        <ul class="method-list">
                            <li><strong>獵人 (Hunter)：</strong>對高密度交會組態的辨識與追蹤能力。行動沿著已形成的結構推進。</li>
                            <li><strong>巫師 (Wizard)：</strong>在既有交會處引入另一層意義維度（如儀式、時間），基於已成立的結構進行擴展。</li>
                            <li><strong>小孩 (Child)：</strong>刻意將行動投向非交會、非合理預期之處，以迫使意義場重新配置。</li>
                        </ul>
                    </div>
                    <button class="expand-btn" onclick="toggleExpand('method-full-zh', this)">+ 閱讀完整論述</button>
                </div>

                <div class="en-only">
                    <div class="method-quote">"Action is not the reproduction of existing content, but the real-time generation of perceptible relational structures."</div>
                    <h3>Abstract</h3>
                    <p>The "Meaning Field Action Performance Method" takes "meaning generation" as its starting point.</p>
                    <div id="method-full-en" class="expand-container method-expand collapsed">
                        <div class="method-subtitle">1. Theoretical Basis</div>
                        <p>"Meaning Field" refers to a dynamic network composed of language, social context, historical residue, spatial conditions, and time scales.</p>
                        <div class="method-subtitle">2. Three Action Modes</div>
                        <ul class="method-list">
                            <li><strong>Hunter:</strong> Ability to identify and track high-density intersection configurations.</li>
                            <li><strong>Wizard:</strong> Introducing another dimension of meaning (e.g., ritual) into existing intersections.</li>
                            <li><strong>Child:</strong> Deliberately casting action towards non-intersecting places to force reconfiguration.</li>
                        </ul>
                    </div>
                    <button class="expand-btn" onclick="toggleExpand('method-full-en', this)">+ Read Full Manifesto</button>
                </div>
            </div>
        </div>

        <div id="about" class="content-section interactive">
            <div class="text-block">
                <h2 class="decode-text" data-zh="關於" data-en="About">關於</h2>
                <div class="photo-wrapper" id="photo-tilt">
                    <img src="profile.jpg" alt="Po-Hao Tseng" class="about-photo" onerror="this.style.display='none'">
                </div>
                <div class="zh-only">
                    <p>台北藝術大學藝術跨域研究所畢。從小學習中國音樂，而後曾師承周定邦先生學習台灣唸歌。</p>
                    <p>近年常參與劇場與聲音相關創作，試圖理解何謂「在當場」。</p>
                    <div class="category-title">聯絡</div>
                    <p>Email: jerry801022@gmail.com</p>
                </div>
                <div class="en-only">
                    <p>MFA, Trans-disciplinary Arts, TNUA. Studied Taiwanese "Nian Ge" under Master Ding-Bang Chou.</p>
                    <p>Actively involved in theater and sound art, exploring the concept of "Being in the Scene."</p>
                    <div class="category-title">Contact</div>
                    <p>Email: jerry801022@gmail.com</p>
                </div>
                <div class="social-links">
                    <a href="https://www.facebook.com/share/1ATPLBnGpg/?mibextid=wwXIfr" target="_blank" class="social-btn">Facebook</a>
                    <a href="https://www.instagram.com/po_hao_tseng?igsh=MTV2dXFiODZwZW4wYg%3D%3D&utm_source=qr" target="_blank" class="social-btn">Instagram</a>
                </div>
            </div>
        </div>

        <div id="experiences" class="content-section interactive">
            <div class="text-block">
                <h2 class="decode-text" data-zh="經歷" data-en="Experience">經歷</h2>
                <div class="zh-only">
                    <div class="category-title">學歷</div>
                    <div class="timeline-item"><span class="year">Present</span><div class="job-title">台北藝術大學 藝術跨領域研究所 (MFA)</div></div>
                    <div class="category-title">現職</div>
                    <div class="timeline-item"><span class="year">Now</span><div class="job-title">藝術、音樂、劇場相關工作者</div></div>
                    <div class="timeline-item"><span class="year">Now</span><div class="job-title">《鬼講堂》計劃人</div></div>
                    <button class="expand-btn" onclick="toggleExpand('zh-full-list', this)">+ 查看完整列表 (Demo)</button>
                    <div id="zh-full-list" class="expand-container collapsed">
                        <div class="timeline-item"><span class="year">2019</span><div class="job-title">台新藝術獎 年度大獎</div></div>
                        <div class="timeline-item"><span class="year">2016</span><div class="job-title">台北雙年展《當下檔案・未來系譜》</div></div>
                    </div>
                </div>
                <div class="en-only">
                    <div class="category-title">Education</div>
                    <div class="timeline-item"><span class="year">Present</span><div class="job-title">MFA, Trans-disciplinary Arts, TNUA</div></div>
                    <div class="category-title">Current Position</div>
                    <div class="timeline-item"><span class="year">Now</span><div class="job-title">Organizer, Lecture Of Ghost</div></div>
                </div>
            </div>
        </div>

        <div id="gallery" class="content-section interactive">
            <div class="text-block">
                <h2 class="decode-text" data-zh="作品" data-en="Works">作品</h2>
                <div id="project-grid-container" class="project-grid"></div>
            </div>
        </div>

        <div id="project-overlay" class="interactive">
            <div id="close-project" onclick="closeProject()">× CLOSE</div>
            <div id="project-content"></div>
        </div>
    </div>

    <script>
        // --- DATA & CONFIG ---
        let currentLang = 'zh';
        const projects = [
            { id: 1, cover: "work1-cover.jpg", year: "2020", zh: { title: "漫遊者劇場《池子》", desc: "臺北", full: "這是一個關於空間記憶與身體介入的場域特定創作。" }, en: { title: "Flâneur Theatre: Pond", desc: "Taipei", full: "A site-specific creation about spatial memory and bodily intervention." }, images: ["work1-01.jpg"] },
            { id: 2, cover: "work2-cover.jpg", year: "2014-Present", zh: { title: "鬼講堂", desc: "焦吧哖事件", full: "試圖理解抗日事件中的多重敘事問題。" }, en: { title: "Lecture of Ghost", desc: "Tapani Incident", full: "Attempting to understand the multiple narratives behind anti-Japanese incidents." }, images: ["work2-01.jpg"] },
            { id: 3, cover: "https://images.unsplash.com/photo-1518640467707-6811f4a6ab73?w=800&q=80", year: "2015", zh: { title: "中國城藝術行動", desc: "台南", full: "記錄消逝的城市紋理。" }, en: { title: "Chinatown Art Action", desc: "Tainan", full: "Recording the vanishing urban texture." }, images: [] }
        ];

        // --- TEST SYSTEM VARIABLES ---
        let isTesting = false;
        let testStartTime = 0;
        let testData = []; // {x, y, time}
        let testTimerInt;
        let resultMode = 'normal'; // normal, hunter, wizard, child

        // --- RENDER FUNCTIONS ---
        function renderProjects() {
            const container = document.getElementById('project-grid-container');
            container.innerHTML = '';
            projects.forEach((p, index) => {
                const div = document.createElement('div');
                div.className = 'project-card';
                div.onclick = () => openProject(index);
                div.onmouseenter = () => hoverEffect(true);
                div.onmouseleave = () => hoverEffect(false);
                const info = p[currentLang];
                const imgSrc = p.cover ? p.cover : 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iNzUiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiMzMzMiLz48L3N2Zz4=';
                div.innerHTML = `<img src="${imgSrc}" class="project-cover" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iNzUiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiMzMzMiLz48L3N2Zz4='"><div class="project-title">${info.title}</div><div class="project-year">${p.year}</div>`;
                container.appendChild(div);
            });
        }
        function openProject(index) {
            const p = projects[index]; const info = p[currentLang];
            const content = document.getElementById('project-content');
            let html = `<div class="detail-header"><div class="detail-title">${info.title}</div><div class="detail-meta">${p.year}</div></div><div class="detail-desc">${info.full}</div>`;
            if (p.images && p.images.length > 0) { html += '<div class="detail-images">'; p.images.forEach(img => { html += `<img src="${img}" onerror="this.style.display='none'">`; }); html += '</div>'; }
            content.innerHTML = html; document.getElementById('project-overlay').classList.add('open');
        }
        function closeProject() { document.getElementById('project-overlay').classList.remove('open'); }

        // --- INTERACTION LOGIC ---
        const photoWrapper = document.getElementById('photo-tilt');
        if(photoWrapper) {
            photoWrapper.addEventListener('mousemove', (e) => {
                const rect = photoWrapper.getBoundingClientRect();
                const rotateY = ((e.clientX - rect.left) / rect.width - 0.5) * 30;
                const rotateX = ((e.clientY - rect.top) / rect.height - 0.5) * -30;
                photoWrapper.querySelector('img').style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
            });
            photoWrapper.addEventListener('mouseleave', () => { photoWrapper.querySelector('img').style.transform = `rotateX(0) rotateY(0)`; });
        }

        function decodeTextEffect() {
            document.querySelectorAll('.decode-text').forEach(el => {
                const originalText = el.getAttribute(`data-${currentLang}`);
                if(!originalText) return;
                let iterations = 0;
                const interval = setInterval(() => {
                    el.innerText = originalText.split('').map((l, i) => {
                        if(i < iterations) return originalText[i];
                        return String.fromCharCode(65 + Math.floor(Math.random() * 26));
                    }).join('');
                    if(iterations >= originalText.length) clearInterval(interval);
                    iterations += 1/2; 
                }, 30);
            });
        }

        function setLanguage(lang) {
            currentLang = lang; document.body.className = `lang-${lang}`;
            renderProjects();
            gsap.to('#lang-screen', { duration: 1, opacity: 0, pointerEvents: 'none' });
            document.getElementById('landing-screen').style.display = 'flex';
            gsap.from('#landing-screen', { duration: 1.5, opacity: 0, delay: 0.5 });
        }

        // --- METHOD INTERACTION TEST LOGIC ---
        function startTest() {
            navigateTo('home');
            // Hide header and nav for immersion
            gsap.to('#site-header', { opacity: 0 });
            gsap.to('#main-nav', { opacity: 0 });
            
            isTesting = true;
            testData = [];
            document.getElementById('test-ui').classList.add('active');
            
            let timeLeft = 10;
            document.getElementById('test-timer').innerText = timeLeft;
            
            testTimerInt = setInterval(() => {
                timeLeft--;
                document.getElementById('test-timer').innerText = timeLeft;
                if(timeLeft <= 0) {
                    endTest();
                }
            }, 1000);
        }

        function endTest() {
            clearInterval(testTimerInt);
            isTesting = false;
            document.getElementById('test-ui').classList.remove('active');
            
            // Analyze Data
            analyzeResult();
            
            // Show Result UI
            document.getElementById('result-ui').classList.add('active');
        }

        function analyzeResult() {
            if(testData.length < 10) { resultMode = 'hunter'; return; } // Too little movement

            let totalDist = 0;
            let stops = 0;
            let speedSum = 0;
            let directionChanges = 0;
            let lastAngle = 0;

            for(let i=1; i<testData.length; i++) {
                const d = Math.sqrt(Math.pow(testData[i].x - testData[i-1].x, 2) + Math.pow(testData[i].y - testData[i-1].y, 2));
                totalDist += d;
                const speed = d; // since interval is consistent roughly per frame
                speedSum += speed;
                
                if(speed < 2) stops++;

                const angle = Math.atan2(testData[i].y - testData[i-1].y, testData[i].x - testData[i-1].x);
                if(Math.abs(angle - lastAngle) > 0.5) directionChanges++;
                lastAngle = angle;
            }

            const avgSpeed = speedSum / testData.length;
            const stopRatio = stops / testData.length;

            // Simple Heuristic Logic
            // Hunter: Low speed, high stops
            // Child: High speed, high direction changes
            // Wizard: Moderate speed, circular (hard to detect perfectly, using fallback)

            if (avgSpeed < 5 || stopRatio > 0.4) {
                resultMode = 'hunter';
            } else if (avgSpeed > 15 || directionChanges > testData.length * 0.3) {
                resultMode = 'child';
            } else {
                resultMode = 'wizard';
            }

            updateResultText();
        }

        function updateResultText() {
            const titleEl = document.getElementById('res-type');
            const descEl = document.getElementById('res-desc');
            
            if(resultMode === 'hunter') {
                titleEl.innerText = currentLang === 'zh' ? '獵人 HUNTER' : 'HUNTER';
                descEl.innerText = currentLang === 'zh' 
                    ? '掌握脈絡交匯點的觀察者。你的移動沉穩而精確，善於在混亂中尋找結構。' 
                    : 'The Observer of intersecting contexts. Your movement is steady and precise, skilled at finding structure in chaos.';
            } else if (resultMode === 'child') {
                titleEl.innerText = currentLang === 'zh' ? '小孩 CHILD' : 'CHILD';
                descEl.innerText = currentLang === 'zh' 
                    ? '在規則之外創造遊戲的玩家。你的能量充滿爆發力，試圖打破既有的意義場邊界。' 
                    : 'The Player who creates games outside the rules. Your energy is explosive, attempting to break the boundaries of the meaning field.';
            } else {
                titleEl.innerText = currentLang === 'zh' ? '巫師 WIZARD' : 'WIZARD';
                descEl.innerText = currentLang === 'zh' 
                    ? '在脈絡交匯點生長新意義的操作者。你透過持續的運作與迴旋，編織出新的可能性。' 
                    : 'The Operator growing new meaning at intersections. Through continuous operation and weaving, you create new possibilities.';
            }
        }

        function resetTest(retry) {
            document.getElementById('result-ui').classList.remove('active');
            if(retry) {
                resultMode = 'normal'; // Reset visuals temporarily
                startTest();
            }
        }

        function finishTest() {
            document.getElementById('result-ui').classList.remove('active');
            // Bring back UI
            gsap.to('#site-header', { opacity: 1 });
            gsap.to('#main-nav', { opacity: 1 });
            // Visuals remain in the detected mode for user to play with
        }


        // --- THREE.JS ---
        let scene, camera, renderer, clock;
        let bgParticles, fgParticles, linesMesh;
        let mouse = new THREE.Vector2(9999, 9999);
        let raycaster;
        let sound, analyser, audioLoader, listener;
        let isAudioActive = false;
        let pulseFactor = 1;
        let isHoveringProject = false;

        const BG_COUNT = 3000, FG_COUNT = 800, CONNECT_DIST = 70, MOUSE_RADIUS = 250;

        init();
        animate();

        function hoverEffect(isHovering) { isHoveringProject = isHovering; }

        function init() {
            const container = document.getElementById('canvas-container');
            clock = new THREE.Clock();
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x050505, 0.001);
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 3000);
            camera.position.z = 600;
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);
            
            const sprite = createGlowSprite();
            
            // BG
            const bgGeo = new THREE.BufferGeometry();
            const bgPos = [];
            for (let i = 0; i < BG_COUNT; i++) bgPos.push((Math.random()-0.5)*3000, (Math.random()-0.5)*2000, (Math.random()-0.5)*2000 - 500);
            bgGeo.setAttribute('position', new THREE.Float32BufferAttribute(bgPos, 3));
            const bgMat = new THREE.PointsMaterial({ color: 0x888888, size: 8, map: sprite, transparent: true, opacity: 0.2, blending: THREE.AdditiveBlending, depthWrite: false });
            bgParticles = new THREE.Points(bgGeo, bgMat);
            scene.add(bgParticles);
            
            // FG
            const fgGeo = new THREE.BufferGeometry();
            const fgPos = [], fgVel = [], fgOrigin = [];
            for (let i = 0; i < FG_COUNT; i++) {
                const x = (Math.random()-0.5)*1200;
                const y = (Math.random()-0.5)*900;
                const z = (Math.random()-0.5)*600;
                fgPos.push(x, y, z);
                fgOrigin.push(x, y, z);
                fgVel.push({x: (Math.random()-0.5)*0.4, y: (Math.random()-0.5)*0.4, z: (Math.random()-0.5)*0.4});
            }
            fgGeo.setAttribute('position', new THREE.Float32BufferAttribute(fgPos, 3));
            fgGeo.setAttribute('origin', new THREE.Float32BufferAttribute(fgOrigin, 3));
            
            const fgMat = new THREE.PointsMaterial({ color: 0xffffff, size: 5, map: sprite, transparent: true, opacity: 0.9, blending: THREE.AdditiveBlending, depthWrite: false });
            fgParticles = new THREE.Points(fgGeo, fgMat);
            fgParticles.userData = { velocity: fgVel };
            scene.add(fgParticles);

            const lineGeo = new THREE.BufferGeometry();
            const linePos = new Float32Array(FG_COUNT * 2 * 3 * 2);
            lineGeo.setAttribute('position', new THREE.BufferAttribute(linePos, 3));
            const lineMat = new THREE.LineBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.3, blending: THREE.AdditiveBlending });
            linesMesh = new THREE.LineSegments(lineGeo, lineMat);
            scene.add(linesMesh);

            raycaster = new THREE.Raycaster();
            document.addEventListener('mousemove', onMouseMove, false);
            document.addEventListener('touchmove', onTouchMove, { passive: false });
            document.addEventListener('touchstart', onTouchMove, { passive: false });
            window.addEventListener('resize', onResize, false);
            listener = new THREE.AudioListener();
            camera.add(listener);
            sound = new THREE.Audio(listener);
            audioLoader = new THREE.AudioLoader();
        }

        function createGlowSprite() {
            const c = document.createElement('canvas'); c.width=64; c.height=64;
            const ctx=c.getContext('2d');
            const g=ctx.createRadialGradient(32,32,0,32,32,32);
            g.addColorStop(0,'rgba(255,255,255,1)'); g.addColorStop(0.3,'rgba(255,255,255,0.4)'); g.addColorStop(1,'rgba(0,0,0,0)');
            ctx.fillStyle=g; ctx.fillRect(0,0,64,64);
            return new THREE.CanvasTexture(c);
        }
        function onTouchMove(e) { if(e.touches.length===1) { const t = e.touches[0]; mouse.x = (t.clientX/window.innerWidth)*2-1; mouse.y = -(t.clientY/window.innerHeight)*2+1; } }
        function onMouseMove(e) { mouse.x = (e.clientX/window.innerWidth)*2-1; mouse.y = -(e.clientY/window.innerHeight)*2+1; }
        
        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();
            if (isAudioActive && analyser) { const data = analyser.getAverageFrequency(); pulseFactor = 1 + (data / 256) * 0.6; } else { pulseFactor = 1 + Math.sin(time * 2) * 0.1; }
            
            // Record Data if Testing
            if(isTesting) {
                // Approximate mouse position in world space for recording isn't strictly necessary, screen space is fine
                // Here we record normalized screen space
                testData.push({x: mouse.x, y: mouse.y, t: Date.now()});
            }

            // --- PARTICLES BEHAVIOR SWITCH ---
            let magneticFactor = isHoveringProject ? 2.5 : 1;
            bgParticles.rotation.y = time * 0.05 * magneticFactor; 
            bgParticles.material.opacity = 0.2 * pulseFactor;

            const pos = fgParticles.geometry.attributes.position.array; 
            const vel = fgParticles.userData.velocity;
            
            raycaster.setFromCamera(mouse, camera);
            const vec = new THREE.Vector3(mouse.x, mouse.y, 0.5); vec.unproject(camera);
            const dir = vec.sub(camera.position).normalize(); const dist = -camera.position.z / dir.z;
            const targetPos = new THREE.Vector3().copy(camera.position).add(dir.multiplyScalar(dist));

            for(let i=0; i<FG_COUNT; i++) {
                const ix = i*3; 
                let vx = vel[i].x * pulseFactor;
                let vy = vel[i].y * pulseFactor;
                let vz = vel[i].z * pulseFactor;

                // SPECIAL BEHAVIORS BASED ON RESULT
                if(resultMode === 'hunter') {
                    // Hunter: Particles slowly gather towards mouse (Focus/Structure)
                    const dx = targetPos.x - pos[ix];
                    const dy = targetPos.y - pos[ix+1];
                    const d = Math.sqrt(dx*dx + dy*dy);
                    if(d < 400) {
                        vx += dx * 0.002;
                        vy += dy * 0.002;
                        // High friction
                        vx *= 0.5; vy *= 0.5;
                    }
                    fgParticles.material.color.setHex(0xaaddff); // Blue-ish white

                } else if (resultMode === 'child') {
                    // Child: Particles explode/scatter from mouse (Chaos)
                    const dx = targetPos.x - pos[ix];
                    const dy = targetPos.y - pos[ix+1];
                    const d = Math.sqrt(dx*dx + dy*dy);
                    if(d < 300) {
                        vx -= dx * 0.05 + (Math.random()-0.5)*2;
                        vy -= dy * 0.05 + (Math.random()-0.5)*2;
                    }
                    fgParticles.material.color.setHex(0xffaa88); // Red-ish white

                } else if (resultMode === 'wizard') {
                    // Wizard: Spiral/Vortex around mouse (Operation)
                    const dx = pos[ix] - targetPos.x;
                    const dy = pos[ix+1] - targetPos.y;
                    const d = Math.sqrt(dx*dx + dy*dy);
                    if(d < 400) {
                        // Rotation force: (-y, x)
                        vx += -dy * 0.005;
                        vy += dx * 0.005;
                        // Gentle attraction
                        vx -= dx * 0.001;
                        vy -= dy * 0.001;
                    }
                     fgParticles.material.color.setHex(0xcc88ff); // Purple-ish white

                } else {
                    // Normal + Magnetic for Gallery
                    fgParticles.material.color.setHex(0xffffff);
                    if(isHoveringProject) {
                        const dx = targetPos.x - pos[ix];
                        const dy = targetPos.y - pos[ix+1];
                        if(Math.abs(dx) < 300 && Math.abs(dy) < 300) {
                            vx += dx * 0.005; vy += dy * 0.005;
                        }
                    }
                }

                pos[ix]+=vx; pos[ix+1]+=vy; pos[ix+2]+=vz;
                
                // Bounds
                if(pos[ix]>600) pos[ix]=-600; if(pos[ix]<-600) pos[ix]=600;
                if(pos[ix+1]>500) pos[ix+1]=-500; if(pos[ix+1]<-500) pos[ix+1]=500;
            }
            fgParticles.geometry.attributes.position.needsUpdate = true;

            // Connections
            let idx = 0; const lineArr = linesMesh.geometry.attributes.position.array;
            const p1 = new THREE.Vector3(), p2 = new THREE.Vector3(); const radius = MOUSE_RADIUS * pulseFactor;
            for(let i=0; i<FG_COUNT; i++) {
                p1.set(pos[i*3], pos[i*3+1], pos[i*3+2]);
                if(p1.distanceTo(targetPos) < radius) {
                    for(let j=i+1; j<FG_COUNT; j++) {
                        p2.set(pos[j*3], pos[j*3+1], pos[j*3+2]);
                        if(p1.distanceTo(p2) < CONNECT_DIST) {
                            lineArr[idx++]=p1.x; lineArr[idx++]=p1.y; lineArr[idx++]=p1.z;
                            lineArr[idx++]=p2.x; lineArr[idx++]=p2.y; lineArr[idx++]=p2.z;
                            if(idx>=lineArr.length) break;
                        }
                    }
                }
            }
            linesMesh.geometry.setDrawRange(0, idx/3); linesMesh.geometry.attributes.position.needsUpdate = true;
            linesMesh.material.opacity = 0.3 * pulseFactor;
            renderer.render(scene, camera);
        }
        function onResize() { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); }

        function enterSite() {
            if (listener.context.state === 'suspended') { listener.context.resume(); }
            document.getElementById('audio-status').innerText = "Loading...";
            audioLoader.load('bgm.mp3', 
                function(buffer) {
                    sound.setBuffer(buffer); sound.setLoop(true); sound.setVolume(0.8); sound.play();
                    analyser = new THREE.AudioAnalyser(sound, 32); isAudioActive = true;
                    document.getElementById('audio-status').innerText = "Playing";
                },
                undefined,
                function() { document.getElementById('audio-status').innerText = "Silent Mode"; }
            );
            gsap.to('#landing-screen', { duration: 1.5, opacity: 0, pointerEvents: 'none' });
            gsap.to('#site-header', { duration: 1, opacity: 1, y: 0, delay: 0.5 });
            gsap.to('nav', { duration: 1, opacity: 1, y: 0, delay: 0.5 });
            gsap.to(camera.position, { duration: 2.5, z: 400, ease: "power2.inOut" });
        }

        window.toggleExpand = function(id, btn) {
            const content = document.getElementById(id);
            if (content.classList.contains('collapsed')) {
                content.style.maxHeight = content.scrollHeight + "px";
                content.classList.remove('collapsed');
                btn.innerText = currentLang === 'zh' ? '- 收起列表' : '- Collapse List';
            } else {
                content.style.maxHeight = null; content.classList.add('collapsed');
                btn.innerText = currentLang === 'zh' ? '+ 查看完整列表' : '+ View Full List';
            }
        };

        window.navigateTo = function(id) {
            document.querySelectorAll('.content-section').forEach(el => { el.classList.remove('active'); gsap.to(el, { opacity: 0, duration: 0.5 }); });
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            
            if(id === 'home') {
                gsap.to(camera.position, { duration: 2, z: 400, x: 0, y: 0, ease: "power2.inOut" });
                return; 
            }

            const btn = Array.from(document.querySelectorAll('.nav-link')).find(b => b.getAttribute('onclick').includes(id));
            if(btn) btn.classList.add('active');
            
            const target = document.getElementById(id);
            if(target) { 
                target.classList.add('active'); 
                gsap.to(target, { opacity: 1, duration: 1, delay: 0.5 }); 
                target.scrollTop = 0; 
                decodeTextEffect();
            }
        }
    </script>
</body>
</html>
